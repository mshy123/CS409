<source>
  @type tail
  format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "GET(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$/
  path /var/log/apache2/access_log
  pos_file /Users/hyunhoha/LocalCEP/fluent/pos/apacheget_kafka
  tag high.apacheget
  time_format %d/%b/%Y:%H:%M:%S %z
  keep_time_key true
</source>

<source>
  @type tail
  format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "GET(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$/
  path /var/log/apache2/access_log
  pos_file /Users/hyunhoha/LocalCEP/fluent/pos/apacheget_elastic
  tag elastic.high.apacheget
  time_format %d/%b/%Y:%H:%M:%S %z
  keep_time_key true
</source>

<source>
  @type tail
  format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "POST(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$/
  path /var/log/apache2/access_log
  pos_file /Users/hyunhoha/LocalCEP/fluent/pos/apachepost_kafka
  tag low.apachepost
  time_format %d/%b/%Y:%H:%M:%S %z
  keep_time_key true
</source>

<source>
  @type tail
  format /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "POST(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$/
  path /var/log/apache2/access_log
  pos_file /Users/hyunhoha/LocalCEP/fluent/pos/apachepost_elastic
  tag elastic.low.apachepost
  time_format %d/%b/%Y:%H:%M:%S %z
  keep_time_key true
</source>

<filter **>
  @type record_transformer
  enable_ruby true
  renew_record true
  <record>
    content ${record.to_json}
    type ${tag}
  </record>
</filter>

<match elastic.**>
  @type elasticsearch
  host localhost
  port 9200
  index_name apacheget
  type_name apacheget
  flush_interval 60s
  logstash_format true
</match>

<match elastic.**>
  @type elasticsearch
  host localhost
  port 9200
  index_name apachepost
  type_name apachepost
  flush_interval 60s
  logstash_format true
</match>

<match high.**>
  @type               kafka
  brokers             127.0.0.1:9092
  default_topic       hightopic
  output_include_time true
</match>

<match low.**>
  @type               kafka
  brokers             127.0.0.1:9092
  default_topic       lowtopic
  output_include_time true
</match>

